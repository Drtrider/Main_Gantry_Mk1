// GantryControl_Mk1
// By: Jeret Shuck
int dirPin = 2; //Sets pin 2 to the stepper direction pin
int stepperPin = 3; //Sets pin 3 to the stepper pin output
int ls = 4; //Setting pin value of limit switch
int startup = 0; //Value if the startup has been ran or not to zero the head.
int ls_current = HIGH; //Current value of limit switch


int h_pos = 0; //Current head position
int stepDistance = 0; //How many steps the motor should take
int cup1 = 1000; //Position of cup 1 through 3
int cup2 = 2000;
int cup3 = 3000;
int cup4 = 4000;



void setup() {
  pinMode(dirPin, OUTPUT); //Sets pinmode to output for direction pin
  pinMode(stepperPin, OUTPUT); //Sets pinmode to output for tepperpin
  pinMode(ls, INPUT);
  pinMode(6, INPUT);//Push button 1 set to input on pin 6
  pinMode(7, INPUT);//Push button 2 set to input on pin 7
  pinMode(8, INPUT);//Push button 3 set to input on pin 8
  pinMode(8, INPUT);//Push button 3 set to input on pin 8
}

void step(boolean dir, int steps) { //Step function for stepping motor
  digitalWrite(dirPin, dir);
  delay(5);
  for (int i = 0; i < steps; i++) {
    digitalWrite(stepperPin, HIGH);
    delayMicroseconds(100);
    digitalWrite(stepperPin, LOW);
    delayMicroseconds(100);
  }
}

int zeroHead() { //Zero head function will run motor to the end stop, and set current position to zero.
  while (ls_current == HIGH) {
    step(false, 400);
    ls_current = digitalRead(ls);
    delay(10);
  }
}

void loop() {

  if (startup == 0) { //If statement to start the zero-head function
    zeroHead();
    startup = 1;
    h_pos = 0;
  }

  if (digitalRead(6) == HIGH) { //Sends head to position one
    stepDistance = cup1 - h_pos;
    if (stepDistance < 0) {
      step(false, abs(stepDistance));
    }
    else
    {
      step(true, stepDistance);
    }
    h_pos = cup1;
    delay(500);
  }

  if (digitalRead(7) == HIGH) { //Sends head to position two
    stepDistance = cup2 - h_pos;
    if (stepDistance < 0) {
      step(false, abs(stepDistance));
    }
    else
    {
      step(true, stepDistance);
    }
    h_pos = cup2;
    delay(500);
  }

  if (digitalRead(8) == HIGH) { //Sends head to position three
    stepDistance = cup3 - h_pos;
    if (stepDistance < 0) {
      step(false, abs(stepDistance));
    }
    else
    {
      step(true, stepDistance);
    }
    h_pos = cup3;
    delay(500);
  }

  if (digitalRead(9) == HIGH) { //Sends head to position Four
    stepDistance = cup4 - h_pos;
    if (stepDistance < 0) {
      step(false, abs(stepDistance));
    }
    else
    {
      step(true, stepDistance);
    }
    h_pos = cup4;
    delay(500);
  }
}
